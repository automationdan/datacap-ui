{"ast":null,"code":"import _toConsumableArray from \"@babel/runtime/helpers/toConsumableArray\";\n/**\n * Copyright IBM Corp. 2020\n *\n * This source code is licensed under the Apache-2.0 license found in the\n * LICENSE file in the root directory of this source tree.\n */\n\nimport findLast from 'lodash.findlast';\nimport { settings } from 'carbon-components';\nimport { DOCUMENT_POSITION_BROAD_PRECEDING, DOCUMENT_POSITION_BROAD_FOLLOWING, selectorTabbable } from './keyboard/navigation';\nvar prefix = settings.prefix;\n/**\n * @param {Node} node A DOM node.\n * @param {string[]} selectorsFloatingMenus The CSS selectors that matches floating menus.\n * @returns {boolean} `true` of the given `node` is in a floating menu.\n */\n\nfunction elementOrParentIsFloatingMenu(node) {\n  var selectorsFloatingMenus = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : [];\n\n  if (node && typeof node.closest === 'function') {\n    var allSelectorsFloatingMenus = [\".\".concat(prefix, \"--overflow-menu-options\"), \".\".concat(prefix, \"--tooltip\"), '.flatpickr-calendar'].concat(_toConsumableArray(selectorsFloatingMenus));\n    return allSelectorsFloatingMenus.some(function (selector) {\n      return node.closest(selector);\n    });\n  }\n}\n/**\n * Ensures the focus is kept in the given `modalNode`, implementing \"focus-wrap\" behavior.\n * @param {object} options The options.\n * @param {Node} options.bodyNode\n * @param {Node} options.startTrapNode The DOM node of the focus sentinel the is placed earlier next to `modalNode`.\n * @param {Node} options.endTrapNode The DOM node of the focus sentinel the is placed next to `modalNode`.\n * @param {Node} options.currentActiveNode The DOM node that has focus.\n * @param {Node} options.oldActiveNode The DOM node that previously had focus.\n * @param {Node} [options.selectorsFloatingMenus] The CSS selectors that matches floating menus.\n */\n\n\nfunction wrapFocus(_ref) {\n  var bodyNode = _ref.bodyNode,\n      startTrapNode = _ref.startTrapNode,\n      endTrapNode = _ref.endTrapNode,\n      currentActiveNode = _ref.currentActiveNode,\n      oldActiveNode = _ref.oldActiveNode,\n      selectorsFloatingMenus = _ref.selectorsFloatingMenus;\n\n  if (bodyNode && currentActiveNode && oldActiveNode && !bodyNode.contains(currentActiveNode) && !elementOrParentIsFloatingMenu(currentActiveNode, selectorsFloatingMenus)) {\n    var comparisonResult = oldActiveNode.compareDocumentPosition(currentActiveNode);\n\n    if (currentActiveNode === startTrapNode || comparisonResult & DOCUMENT_POSITION_BROAD_PRECEDING) {\n      var tabbable = findLast(bodyNode.querySelectorAll(selectorTabbable), function (elem) {\n        return Boolean(elem.offsetParent);\n      });\n\n      if (tabbable) {\n        tabbable.focus();\n      } else if (bodyNode !== oldActiveNode) {\n        bodyNode.focus();\n      }\n    } else if (currentActiveNode === endTrapNode || comparisonResult & DOCUMENT_POSITION_BROAD_FOLLOWING) {\n      var _tabbable = Array.prototype.find.call(bodyNode.querySelectorAll(selectorTabbable), function (elem) {\n        return Boolean(elem.offsetParent);\n      });\n\n      if (_tabbable) {\n        _tabbable.focus();\n      } else if (bodyNode !== oldActiveNode) {\n        bodyNode.focus();\n      }\n    }\n  }\n}\n\nexport { elementOrParentIsFloatingMenu };\nexport default wrapFocus;","map":{"version":3,"sources":["/Users/danielcrow/Documents/development/cloudfoundry/capture/capture-ui/node_modules/carbon-components-react/es/internal/wrapFocus.js"],"names":["_toConsumableArray","findLast","settings","DOCUMENT_POSITION_BROAD_PRECEDING","DOCUMENT_POSITION_BROAD_FOLLOWING","selectorTabbable","prefix","elementOrParentIsFloatingMenu","node","selectorsFloatingMenus","arguments","length","undefined","closest","allSelectorsFloatingMenus","concat","some","selector","wrapFocus","_ref","bodyNode","startTrapNode","endTrapNode","currentActiveNode","oldActiveNode","contains","comparisonResult","compareDocumentPosition","tabbable","querySelectorAll","elem","Boolean","offsetParent","focus","_tabbable","Array","prototype","find","call"],"mappings":"AAAA,OAAOA,kBAAP,MAA+B,0CAA/B;AAEA;AACA;AACA;AACA;AACA;AACA;;AACA,OAAOC,QAAP,MAAqB,iBAArB;AACA,SAASC,QAAT,QAAyB,mBAAzB;AACA,SAASC,iCAAT,EAA4CC,iCAA5C,EAA+EC,gBAA/E,QAAuG,uBAAvG;AACA,IAAIC,MAAM,GAAGJ,QAAQ,CAACI,MAAtB;AACA;AACA;AACA;AACA;AACA;;AAEA,SAASC,6BAAT,CAAuCC,IAAvC,EAA6C;AAC3C,MAAIC,sBAAsB,GAAGC,SAAS,CAACC,MAAV,GAAmB,CAAnB,IAAwBD,SAAS,CAAC,CAAD,CAAT,KAAiBE,SAAzC,GAAqDF,SAAS,CAAC,CAAD,CAA9D,GAAoE,EAAjG;;AAEA,MAAIF,IAAI,IAAI,OAAOA,IAAI,CAACK,OAAZ,KAAwB,UAApC,EAAgD;AAC9C,QAAIC,yBAAyB,GAAG,CAAC,IAAIC,MAAJ,CAAWT,MAAX,EAAmB,yBAAnB,CAAD,EAAgD,IAAIS,MAAJ,CAAWT,MAAX,EAAmB,WAAnB,CAAhD,EAAiF,qBAAjF,EAAwGS,MAAxG,CAA+Gf,kBAAkB,CAACS,sBAAD,CAAjI,CAAhC;AACA,WAAOK,yBAAyB,CAACE,IAA1B,CAA+B,UAAUC,QAAV,EAAoB;AACxD,aAAOT,IAAI,CAACK,OAAL,CAAaI,QAAb,CAAP;AACD,KAFM,CAAP;AAGD;AACF;AACD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA,SAASC,SAAT,CAAmBC,IAAnB,EAAyB;AACvB,MAAIC,QAAQ,GAAGD,IAAI,CAACC,QAApB;AAAA,MACIC,aAAa,GAAGF,IAAI,CAACE,aADzB;AAAA,MAEIC,WAAW,GAAGH,IAAI,CAACG,WAFvB;AAAA,MAGIC,iBAAiB,GAAGJ,IAAI,CAACI,iBAH7B;AAAA,MAIIC,aAAa,GAAGL,IAAI,CAACK,aAJzB;AAAA,MAKIf,sBAAsB,GAAGU,IAAI,CAACV,sBALlC;;AAOA,MAAIW,QAAQ,IAAIG,iBAAZ,IAAiCC,aAAjC,IAAkD,CAACJ,QAAQ,CAACK,QAAT,CAAkBF,iBAAlB,CAAnD,IAA2F,CAAChB,6BAA6B,CAACgB,iBAAD,EAAoBd,sBAApB,CAA7H,EAA0K;AACxK,QAAIiB,gBAAgB,GAAGF,aAAa,CAACG,uBAAd,CAAsCJ,iBAAtC,CAAvB;;AAEA,QAAIA,iBAAiB,KAAKF,aAAtB,IAAuCK,gBAAgB,GAAGvB,iCAA9D,EAAiG;AAC/F,UAAIyB,QAAQ,GAAG3B,QAAQ,CAACmB,QAAQ,CAACS,gBAAT,CAA0BxB,gBAA1B,CAAD,EAA8C,UAAUyB,IAAV,EAAgB;AACnF,eAAOC,OAAO,CAACD,IAAI,CAACE,YAAN,CAAd;AACD,OAFsB,CAAvB;;AAIA,UAAIJ,QAAJ,EAAc;AACZA,QAAAA,QAAQ,CAACK,KAAT;AACD,OAFD,MAEO,IAAIb,QAAQ,KAAKI,aAAjB,EAAgC;AACrCJ,QAAAA,QAAQ,CAACa,KAAT;AACD;AACF,KAVD,MAUO,IAAIV,iBAAiB,KAAKD,WAAtB,IAAqCI,gBAAgB,GAAGtB,iCAA5D,EAA+F;AACpG,UAAI8B,SAAS,GAAGC,KAAK,CAACC,SAAN,CAAgBC,IAAhB,CAAqBC,IAArB,CAA0BlB,QAAQ,CAACS,gBAAT,CAA0BxB,gBAA1B,CAA1B,EAAuE,UAAUyB,IAAV,EAAgB;AACrG,eAAOC,OAAO,CAACD,IAAI,CAACE,YAAN,CAAd;AACD,OAFe,CAAhB;;AAIA,UAAIE,SAAJ,EAAe;AACbA,QAAAA,SAAS,CAACD,KAAV;AACD,OAFD,MAEO,IAAIb,QAAQ,KAAKI,aAAjB,EAAgC;AACrCJ,QAAAA,QAAQ,CAACa,KAAT;AACD;AACF;AACF;AACF;;AAED,SAAS1B,6BAAT;AACA,eAAeW,SAAf","sourcesContent":["import _toConsumableArray from \"@babel/runtime/helpers/toConsumableArray\";\n\n/**\n * Copyright IBM Corp. 2020\n *\n * This source code is licensed under the Apache-2.0 license found in the\n * LICENSE file in the root directory of this source tree.\n */\nimport findLast from 'lodash.findlast';\nimport { settings } from 'carbon-components';\nimport { DOCUMENT_POSITION_BROAD_PRECEDING, DOCUMENT_POSITION_BROAD_FOLLOWING, selectorTabbable } from './keyboard/navigation';\nvar prefix = settings.prefix;\n/**\n * @param {Node} node A DOM node.\n * @param {string[]} selectorsFloatingMenus The CSS selectors that matches floating menus.\n * @returns {boolean} `true` of the given `node` is in a floating menu.\n */\n\nfunction elementOrParentIsFloatingMenu(node) {\n  var selectorsFloatingMenus = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : [];\n\n  if (node && typeof node.closest === 'function') {\n    var allSelectorsFloatingMenus = [\".\".concat(prefix, \"--overflow-menu-options\"), \".\".concat(prefix, \"--tooltip\"), '.flatpickr-calendar'].concat(_toConsumableArray(selectorsFloatingMenus));\n    return allSelectorsFloatingMenus.some(function (selector) {\n      return node.closest(selector);\n    });\n  }\n}\n/**\n * Ensures the focus is kept in the given `modalNode`, implementing \"focus-wrap\" behavior.\n * @param {object} options The options.\n * @param {Node} options.bodyNode\n * @param {Node} options.startTrapNode The DOM node of the focus sentinel the is placed earlier next to `modalNode`.\n * @param {Node} options.endTrapNode The DOM node of the focus sentinel the is placed next to `modalNode`.\n * @param {Node} options.currentActiveNode The DOM node that has focus.\n * @param {Node} options.oldActiveNode The DOM node that previously had focus.\n * @param {Node} [options.selectorsFloatingMenus] The CSS selectors that matches floating menus.\n */\n\n\nfunction wrapFocus(_ref) {\n  var bodyNode = _ref.bodyNode,\n      startTrapNode = _ref.startTrapNode,\n      endTrapNode = _ref.endTrapNode,\n      currentActiveNode = _ref.currentActiveNode,\n      oldActiveNode = _ref.oldActiveNode,\n      selectorsFloatingMenus = _ref.selectorsFloatingMenus;\n\n  if (bodyNode && currentActiveNode && oldActiveNode && !bodyNode.contains(currentActiveNode) && !elementOrParentIsFloatingMenu(currentActiveNode, selectorsFloatingMenus)) {\n    var comparisonResult = oldActiveNode.compareDocumentPosition(currentActiveNode);\n\n    if (currentActiveNode === startTrapNode || comparisonResult & DOCUMENT_POSITION_BROAD_PRECEDING) {\n      var tabbable = findLast(bodyNode.querySelectorAll(selectorTabbable), function (elem) {\n        return Boolean(elem.offsetParent);\n      });\n\n      if (tabbable) {\n        tabbable.focus();\n      } else if (bodyNode !== oldActiveNode) {\n        bodyNode.focus();\n      }\n    } else if (currentActiveNode === endTrapNode || comparisonResult & DOCUMENT_POSITION_BROAD_FOLLOWING) {\n      var _tabbable = Array.prototype.find.call(bodyNode.querySelectorAll(selectorTabbable), function (elem) {\n        return Boolean(elem.offsetParent);\n      });\n\n      if (_tabbable) {\n        _tabbable.focus();\n      } else if (bodyNode !== oldActiveNode) {\n        bodyNode.focus();\n      }\n    }\n  }\n}\n\nexport { elementOrParentIsFloatingMenu };\nexport default wrapFocus;"]},"metadata":{},"sourceType":"module"}